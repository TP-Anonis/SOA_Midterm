<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Đơn Hàng</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./font/fontawesome-free-6.5.1-web/css/all.min.css">
    <link rel="stylesheet" href="./asset/css/Trangchu.css">
    <style>
        .avatar-navbar {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 50%;
            margin-right: 5px;
            margin-left: 30px;
            cursor: pointer;
        }
        .avatar-navbar:hover {
            opacity: 0.8;
        }
        .modal-custom {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content-custom {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            width: 300px;
        }
        .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }
        .nav-tabs .nav-link {
            font-weight: bold;
            color: #007bff;
        }
        .nav-tabs .nav-link.active {
            color: #ffffff;
            background-color: #007bff;
        }
    </style>
</head>
<body>
    <!-- Kiểm tra đăng nhập -->
    <script>
        if (!localStorage.getItem("accessToken")) {
            window.location.href = "DangNhap.html";
        }
    </script>

    <nav class="navbar navbar-expand-lg navbar-light bg-light py-3">
        <div class="container">
            <a class="navbar-brand" href="../asset/Datban.html">
                <i class="fa-solid fa-utensils"></i> Vietnamese Restaurant
            </a>           
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item"><a class="nav-link" href="./QuanlyDonHang.html">Quản lý</a></li>
                    <li class="nav-item"><a class="nav-link px-3" href="./Daubep.html">Đầu bếp</a></li>
                    <li class="nav-item d-flex align-items-center">
                        <a class="nav-link px-3" href="./Datban.html">Đặt Bàn</a>
                    </li>
                    <li class="nav-item d-flex align-items-center">
                        <img id="navbarAvatar" src="https://via.placeholder.com/40" alt="Avatar" class="avatar-navbar" onclick="document.getElementById('avatarInput').click()">
                        <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="changeAvatar(event)">
                        <span id="employeeCode" class="nav-link px-2 fw-bold text-primary"></span>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-outline-danger ms-3" onclick="logout()">Đăng xuất</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Mục Quản Lý -->
    <div id="manager-section" class="container mt-5">
        <h2 class="text-center mb-4">Quản Lý Đơn Hàng</h2>

        <!-- Thanh Tab -->
        <ul class="nav nav-tabs" id="orderTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="ongoing-tab" data-bs-toggle="tab" data-bs-target="#ongoing" type="button" role="tab" aria-controls="ongoing" aria-selected="true">Đơn Hàng Đang Thực Hiện</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="current-shift-tab" data-bs-toggle="tab" data-bs-target="#current-shift" type="button" role="tab" aria-controls="current-shift" aria-selected="false">Tổng Hợp Hóa Đơn Tính Tiền</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="revenue-tab" data-bs-toggle="tab" data-bs-target="#revenue" type="button" role="tab" aria-controls="revenue" aria-selected="false">Tổng Doanh Thu</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab" aria-controls="history" aria-selected="false">Lịch Sử Đơn Hàng</button>
            </li>
        </ul>

        <!-- Nội dung Tab -->
        <div class="tab-content" id="orderTabsContent">
            <!-- Đơn Hàng Đang Thực Hiện -->
            <div class="tab-pane fade show active" id="ongoing" role="tabpanel" aria-labelledby="ongoing-tab">
                <div class="table-responsive mt-3" style="max-height: 400px; overflow-y: auto;">
                    <table class="table table-bordered shadow-sm">
                        <thead class="table-primary">
                            <tr>
                                <th>ID Đơn</th>
                                <th>Bàn</th>
                                <th>Món Ăn</th>
                                <th>Thời Gian Đặt</th>
                                <th>Thời Gian Giao</th>
                                <th>Trạng Thái</th>
                                <th>Hành Động</th>
                            </tr>
                        </thead>
                        <tbody id="ongoing-orders"></tbody>
                    </table>
                </div>
            </div>

            <!-- Tổng Hợp Phiếu Tính Tiền Trong Ca Trực -->
            <div class="tab-pane fade" id="current-shift" role="tabpanel" aria-labelledby="current-shift-tab">
                <div class="table-responsive mt-3" style="max-height: 400px; overflow-y: auto;">
                    <table class="table table-bordered shadow-sm">
                        <thead class="table-info">
                            <tr>
                                <th>ID Hóa Đơn</th>
                                <th>Tổng Tiền</th>
                                <th>Thời Gian Thanh Toán</th>
                            </tr>
                        </thead>
                        <tbody id="current-shift-bills"></tbody>
                    </table>
                </div>
            </div>

            <!-- Tổng Doanh Thu Trong Ca Trực -->
            <div class="tab-pane fade" id="revenue" role="tabpanel" aria-labelledby="revenue-tab">
                <h3 class="mt-3 text-center">Tổng Doanh Thu Trong Ca Trực: <span id="total-revenue">0đ</span></h3>
            </div>

            <!-- Lịch Sử Đơn Hàng -->
            <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="history-tab">
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <h3>Lịch Sử Đơn Hàng</h3>
                    <div class="d-flex align-items-center">
                        <select id="revenue-filter" class="form-select me-2" onchange="filterOrders()">
                            <option value="all">Tất cả</option>
                            <option value="day">Theo ngày</option>
                            <option value="month">Theo tháng</option>
                            <option value="year">Theo năm</option>
                        </select>
                        <button class="btn btn-danger btn-sm" onclick="showConfirmModal('Bạn có chắc muốn xóa toàn bộ lịch sử không?', clearHistory)">Xóa Lịch Sử</button>
                    </div>
                </div>
                <div class="table-responsive mt-3" style="max-height: 400px; overflow-y: auto;">
                    <table class="table table-bordered shadow-sm">
                        <thead class="table-success">
                            <tr>
                                <th>ID Đơn</th>
                                <th>Bàn</th>
                                <th>Món Ăn</th>
                                <th>Thời Gian Giao</th>
                                <th>Thời Gian Thanh Toán</th>
                                <th>Trạng Thái</th>
                                <th>Hành Động</th>
                            </tr>
                        </thead>
                        <tbody id="order-history"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Xác Nhận -->
    <div id="confirmModal" class="modal-custom">
        <div class="modal-content-custom">
            <h4>Xác nhận hành động</h4>
            <p id="confirmMessage"></p>
            <div class="modal-buttons">
                <button class="btn btn-danger" id="confirmYes">Đồng ý</button>
                <button class="btn btn-secondary" id="confirmNo">Hủy</button>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./js/QuanlyDonHang.js"></script>
</body>
</html>